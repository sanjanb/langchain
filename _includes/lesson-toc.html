{% comment %} Mini table of contents for lesson pages. Extracts h2 and h3
headings from page content and generates anchor links. {% endcomment %} {%
assign raw = page.content %} {% assign lines = raw | split: '\n' %}

<div class="callout tip lesson-toc">
  <div class="callout-title">On this page</div>
  <ul class="lesson-toc-list">
    {% for line in lines %} {% assign trimmed = line | strip %} {% unless
    trimmed == blank %} {% comment %} Skip lines with Liquid syntax {%
    endcomment %} {% unless trimmed contains '{%' or trimmed contains '{{' %} {%
    assign is_h2 = false %} {% assign is_h3 = false %} {% comment %} Check if
    line starts with ## {% endcomment %} {% assign first_chars = trimmed |
    slice: 0, 3 %} {% if first_chars == '## ' %} {% assign is_h2 = true %} {%
    assign heading_text = trimmed | remove_first: '## ' | strip %} {% endif %}
    {% comment %} Check if line starts with ### {% endcomment %} {% assign
    first_chars = trimmed | slice: 0, 4 %} {% if first_chars == '### ' %} {%
    assign is_h3 = true %} {% assign heading_text = trimmed | remove_first: '###
    ' | strip %} {% endif %} {% if is_h2 or is_h3 %} {% comment %} Generate slug
    {% endcomment %} {% assign slug = heading_text | downcase %} {% assign slug
    = slug | replace: ' & ', '-' | replace: '&', '-' %} {% assign slug = slug |
    replace: '.', '' | replace: ',', '' | replace: ':', '' | replace: ';', '' %}
    {% assign slug = slug | replace: '`', '' | replace: '"', '' | replace: "'",
    '' %} {% assign slug = slug | replace: '(', '' | replace: ')', '' | replace:
    '[', '' | replace: ']', '' %} {% assign slug = slug | replace: '/', '-' |
    replace: '?', '' | replace: '!', '' %} {% assign slug = slug | replace: '%',
    '' | replace: '#', '' %} {% assign slug = slug | replace: ' ', ' ' |
    replace: ' ', ' ' %} {% assign slug = slug | strip | replace: ' ', '-' %} {%
    assign slug = slug | replace: '--', '-' | replace: '--', '-' %} {% if is_h2
    %}
    <li class="lvl2"><a href="#{{ slug }}">{{ heading_text }}</a></li>
    {% elsif is_h3 %}
    <li class="lvl3"><a href="#{{ slug }}">{{ heading_text }}</a></li>
    {% endif %} {% endif %} {% endunless %} {% endunless %} {% endfor %}
  </ul>
</div>
